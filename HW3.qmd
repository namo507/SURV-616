---
title: "Homework 3: Namit Shrivastava"
format: pdf
editor: visual
---

## 1. The following data come from a case-control study. The cases were sampled from a registry of all lung cancer patients at a set of 6 clinics. The controls were sampled from the patients at the 6 clinics who did not have lung cancer. Each group was asked if they had ever been regular smokers. The researchers made the following claims (1a-1f) based upon these data. State whether the claim is TRUE or FALSE and explain your answer. In this case, the population of interest is those persons who visited the 6 clinics over a specified time period.

| Smoker | Lung Cancer |     
|        | Yes | No    |
|:-------|:---:|:-----:|
| Yes    | 126 | 100   |
| No     | 35  | 61    |

First let me define variables:
* $n_{11} = 126$ (Smokers with lung cancer)
* $n_{12} = 100$ (Smokers without lung cancer)
* $n_{21} = 35$ (Non-smokers with lung cancer)
* $n_{22} = 61$ (Non-smokers without lung cancer)
* $N = n_{11} + n_{12} + n_{21} + n_{22} = 322$ (Total sample size)

## 1. a) [5 points] The proportion with cancer in the population is estimated by (126+35)/(126+35+100+61)=0.5.

False

$\hat{p}_{cancer} = \frac{n_{11} + n_{21}}{N} = \frac{126 + 35}{322} = 0.5$
```{r}
cancer_yes <- 126 + 35
total <- 126 + 35 + 100 + 61
p_cancer <- cancer_yes/total
cat("Proportion with cancer(sampled):", round(p_cancer, 3))
```

The reason this is False is because it is a case-control study where cases and controls were sampled separately. The proportion 0.5 is by design and doesn't estimate the true population proportion. In simpler terms, the provided calculation estimates the proportion of lung cancer in the sample, not the population.  These case-control studies are designed to oversample cases (people with the disease) to have enough data for analysis. So the sample proportions do not reflect the population proportions. Hence one cannot estimate the population prevalence of lung cancer from a case-control study.

## b) [5 points] The proportion of the population that smokes is estimated by (126+100)/ (126+35+100+61)=0.702.

$\hat{p}{smoker} = \frac{n{11} + n_{12}}{N} = \frac{126 + 100}{322} = 0.702$

False

```{r}
smokers <- 126 + 100
p_smokers <- smokers/total
cat("Proportion of smokers(sampled):", round(p_smokers, 3))
```

Similar to 1a previously, this calculation estimates the proportion of smokers in the sample, not the population.  The sampling scheme of a case-control study distorts the proportions of exposures (like smoking) in the sample compared to the population.

## c) [5 points] The probability of having lung cancer among Smokers is estimated by 126/226=0.558.

$\hat{p}{cancer|smoker} = \frac{n{11}}{n_{11} + n_{12}} = \frac{126}{226} = 0.558$

True

```{r}
cancer_smokers <- 126
total_smokers <- 226
cancer_given_smoker <- cancer_smokers / total_smokers
cat("P(cancer|smoker):", round(cancer_given_smoker, 3))
```

So assuming that the this question part does not talk about the population but now talking about this sample case study, so this calculation is correct for estimating the probability of having lung cancer among smokers in the study sample. One can divide the number of smokers with lung cancer (126) by the total number of smokers (126 + 100 = 226).
In layman’s terms, if one looks only at the smokers in the study, approximately 55.8% of them have lung cancer.


## d) [5 points] The probability of having lung cancer among Non-Smokers is estimated by 35/96=0.365.

$\hat{p}{cancer|non-smoker} = \frac{n{21}}{n_{21} + n_{22}} = \frac{35}{96} = 0.365$

True

```{r}
cancer_nonsmokers <- 35
total_nonsmokers <- 96
cancer_given_nonsmoker <- cancer_nonsmokers / total_nonsmokers
cat("P(cancer|non-smoker):", round(cancer_given_nonsmoker, 3))
```

Again, assuming that the this question part does not talk about the population but now talking about this sample case study, this calculation is correct for estimating the probability of having lung cancer among non-smokers in the study sample. One can divide the number of non-smokers with lung cancer (35) by the total number of non-smokers (35 + 61 = 96).
In layman’s terms, if one looks only at the non-smokers in this study, approximately 36.5% of them have lung cancer.

## e) [5 points] The relative risk of having lung cancer, Smokers relative to non-Smokers is 0.558/0.365=1.529.

$RR = \frac{\hat{p}{cancer|smoker}}{\hat{p}{cancer|non-smoker}} = \frac{0.558}{0.365} = 1.529$

False

```{r}
relative_risk <- cancer_given_smoker / cancer_given_nonsmoker
cat("Relative Risk:", round(relative_risk, 3))
```

In a case-control study, one cannot directly calculate the relative risk because the incidence rates in the exposed and unexposed groups are not available. Since, in class theory, I remember that Relative risk is the ratio of the probability of disease in the exposed group to the probability of disease in the unexposed group.  Now simply, because these case-control studies don't give the true population probabilities of having the disease, one can't calculate the relative risk.

## f) [5 points] The odds ratio of having lung cancer for smokers relative to non-smokers is (12661)/(35100)=2.196.

$OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{126 \times 61}{100 \times 35} = 2.196$

True
```{r}
OR <- (126*61)/(100*35)
cat("Odds Ratio:", round(OR, 3))
```

Now the Odds ratio is valid for case-control studies as it doesn't require probability estimation. So the correct calculation steps will be :
1) First, calculating odds for smokers:
$Odds_{smoker} = \frac{n_{11}}{n_{12}} = \frac{126}{100} = 1.26$

2) Calculating odds for non-smokers:
$Odds_{non-smoker} = \frac{n_{21}}{n_{22}} = \frac{35}{61} = 0.574$

3) The odds ratio is:
$OR = \frac{Odds_{smoker}}{Odds_{non-smoker}} = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{126 \times 61}{100 \times 35} = 2.196$

## g) [10 points] Now you must find the 95% CI for the odds ratio from these data.

Now going step by step for the calculation:
Given values variables are:
* $n_{11} = 126$ (Smokers with lung cancer)
* $n_{12} = 100$ (Smokers without lung cancer)
* $n_{21} = 35$ (Non-smokers with lung cancer)
* $n_{22} = 61$ (Non-smokers without lung cancer)

1) First, calculating OR:
$OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{126 \times 61}{100 \times 35} = 2.196$

2) Taking natural logarithm:
$ln(OR) = ln(2.196) = 0.787$

3) Calculating standard error:
$SE_{ln(OR)} = \sqrt{\frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}}}$

$SE_{ln(OR)} = \sqrt{\frac{1}{126} + \frac{1}{100} + \frac{1}{35} + \frac{1}{61}}$

$SE_{ln(OR)} = \sqrt{0.00794 + 0.01000 + 0.02857 + 0.01639} = \sqrt{0.06290} = 0.2508$

4) 95% CI for log(OR):
$ln(OR) \pm 1.96 \times SE_{ln(OR)}$
$0.787 \pm 1.96(0.2508) = (0.295, 1.279)$

5) Therefore, 95% CI for OR:
$(e^{0.295}, e^{1.279}) = (1.343, 3.593)$

The R code for this is:
```{r}
# Calculate odds ratio
or <- (126*61)/(100*35)

# Calculate log(OR) and SE
log_or <- log(or)
se_log_or <- sqrt(1/126 + 1/100 + 1/35 + 1/61)

# Calculate 95% CI
z <- qnorm(0.975)  # for 95% CI
ci_lower <- exp(log_or - z*se_log_or)
ci_upper <- exp(log_or + z*se_log_or)

# Print results
cat("Odds Ratio:", round(or, 3), "\n")
cat("95% CI:", round(ci_lower, 3), "-", round(ci_upper, 3))
```

So infering the results. Based on my analysis of the case-control data, I found an odds ratio of 2.196 with a 95% confidence interval of (1.343, 3.590). This tells me that smokers have approximately 2.2 times higher odds of developing lung cancer compared to non-smokers. Since the confidence interval doesn't include 1, I can say this association is statistically significant at the 0.05 level. Even at the lower bound of the interval (1.343), smokers have at least 34% higher odds of lung cancer, while the upper bound suggests the odds could be as high as 3.59 times higher. This provides strong evidence for a meaningful relationship between smoking and lung cancer risk in this clinic population. The relatively wide confidence interval (spanning from about 1.3 to 3.6) suggests some uncertainty in the precise magnitude of the association, though the direction and significance of the effect are clear.



## 2. The following data come from a retrospective study of the association between smoking and bladder cancer.
| Smoker | Bladder Cancer |     
|        | Yes | No       |
|:-------|:---:|:--------:|
| Yes    | 250 | 99,750   |
| No     | 125 | 199,875  |

## 2. a) [5 points] Given that we cannot estimate the relative risk from these data, what assumption do we need to make in order to estimate the attributable risk from these data?

So, to estimate attributable risk from retrospective (case-control) data, one must assume the disease is rare in the population. This allows the odds ratio (OR) to approximate the relative risk (RR), enabling valid estimation of attributable risk parameters.

$OR \approx RR$ when disease is rare (i.e., when incidence < 10%)

Here, incidence = $\frac{250 + 125}{300,000} = 0.00125$ or 0.125%, which is rare.

Now what one needs to remember is a big assumption is to be made that the study population is representative of the general population, and that the proportion of smokers and non-smokers with bladder cancer observed in this study mirrors the actual risk in the general population.

## 2. b) [15 points] Please estimate the attributable risk for the population of having bladder cancer due to smoking. What is a 95% confidence interval around the estimated attributable risk for the population?

Ok so the attributable risk is calculated as the difference in the incidence of bladder cancer between smokers and non-smokers.

AR = P(E) * (RR-1)

where P(E) is the proportion of the population exposed to the risk factor (smoking), and RR is the relative risk.

So to estimate attributable risk from retrospective (case-control) data, one must assume the disease is rare in the population. This allows the odds ratio (OR) to approximate the relative risk (RR), enabling valid estimation of attributable risk parameters.

1) First, calculating odds ratio:
$OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{250 \times 199,875}{99,750 \times 125} = 4.01$

```{r}
n11 <- 250
n12 <- 99750
n21 <- 125
n22 <- 199875
N <- n11 + n12 + n21 + n22

# Calculating OR
or <- (n11*n22)/(n12*n21)
or
```

2) Calculating proportion of population exposed (smoking prevalence):

$p_e = \frac{n_{11} + n_{12}}{N} = \frac{100,000}{300,000} = \frac{1}{3}$
```{r}
pe <- (n11 + n12)/N
pe
```

3) Population Attributable Risk (PAR) will be given as:
$PAR = \frac{p_e(OR-1)}{1 + p_e(OR-1)}$

$PAR = \frac{\frac{1}{3}(4-1)}{1 + \frac{1}{3}(4-1)} = \frac{1}{2} = 0.5$ or 50%
```{r}
par <- (pe*(or-1))/(1 + pe*(or-1))
par
```

4) For 95% CI:
Step 1: Calculate $SE_{ln(OR)}$
$SE_{ln(OR)} = \sqrt{\frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}}}$

$SE_{ln(OR)} = \sqrt{\frac{1}{250} + \frac{1}{99,750} + \frac{1}{125} + \frac{1}{199,875}}$

$SE_{ln(OR)} = \sqrt{0.004 + 0.00001 + 0.008 + 0.000005}$

$SE_{ln(OR)} = \sqrt{0.012015} = 0.1096$

Step 2: Calculate 95% CI for log(OR)
$ln(OR) = ln(4) = 1.386$

$ln(OR) \pm 1.96 \times SE_{ln(OR)}$
$1.386 \pm 1.96(0.1096)$
$1.386 \pm 0.215$
$(1.171, 1.601)$

Step 3: Convert back to OR scale
$CI_{OR} = (e^{1.171}, e^{1.601})$
$CI_{OR} = (3.225, 4.957)$

Step 4: Calculate PAR CI using OR CI
$PAR_{lower} = \frac{\frac{1}{3}(3.225-1)}{1 + \frac{1}{3}(3.225-1)} = 0.427$

$PAR_{upper} = \frac{\frac{1}{3}(4.957-1)}{1 + \frac{1}{3}(4.957-1)} = 0.569$

Therefore, 95% CI for PAR = (0.427, 0.569)
```{r}
# Calculating CI for PAR
log_or <- log(or)
se_log_or <- sqrt(1/n11 + 1/n12 + 1/n21 + 1/n22)
ci_or_lower <- exp(log_or - 1.96*se_log_or)
ci_or_upper <- exp(log_or + 1.96*se_log_or)

# PAR CI
par_lower <- (pe*(ci_or_lower-1))/(1 + pe*(ci_or_lower-1))
par_upper <- (pe*(ci_or_upper-1))/(1 + pe*(ci_or_upper-1))

# Print results
cat("OR:", round(or, 2), "\n")
cat("PAR:", round(par, 3), "\n")
cat("95% CI for PAR:", round(par_lower, 3), "-", round(par_upper, 3))
```

Based on my analysis of the bladder cancer data, I found that smoking has a substantial impact on bladder cancer risk in this population. The odds ratio of 4.01 indicates that smokers have about 4 times the odds of developing bladder cancer compared to non-smokers. More importantly, the Population Attributable Risk (PAR) of 0.501 suggests that approximately 50.1% of bladder cancer cases in this population could potentially be prevented by eliminating smoking exposure. The 95% confidence interval for the PAR (0.427, 0.569) tells me that I can be 95% confident that the true proportion of bladder cancer cases attributable to smoking lies between 42.7% and 56.9%. This is a remarkably wide impact - even at the lower bound of our estimate, smoking accounts for over 40% of bladder cancer cases in this population. These findings strongly support the public health significance of smoking cessation programs for bladder cancer prevention.

## 3.The following data come from a fictional prospective study of the association between baldness and heart disease. The sample was randomly selected from the population and then followed to see if they developed baldness and/or heart disease.
| Baldness | Heart Disease |     
|         | Yes | No      |
|:---------|:---:|:------:|
| Yes      | 127 | 1,224  |
| No       | 548 | 7,611  |


