---
title: "Homework 2: Namit Shrivastava"
format: pdf
editor: visual
---
## 1. [5 points] A researcher who wants to study the predictors of lung cancer draws a sample of persons with lung cancer from a database of lung cancer patients and a sample of persons without lung cancer from the general population. Is this a prospective or retrospective study?

I think this is a retrospective study. 
Now from the class lecture, in a retrospective study, researchers look back in time to examine data or events that have already occurred. So in this scenario, the researcher is selecting a group of individuals who already have lung cancer (cases) and comparing them to a group of individuals without lung cancer (controls). Simply the goal here is to investigate potential predictors or risk factors by analyzing past exposures or characteristics in these two groups.

So the key aspect to be pointed here is that the researcher is not following participants over time to see who develops lung cancer (which in turn would make it a prospective study). Instead, they are starting with an outcome (lung cancer) that has already happened and working backward to identify possible causes or predictors. This backward-looking approach in the question mentioned is what defines a retrospective study.


## 2. [5 Points] A researcher who wants to study the impact of Vitamin D on children’s health draws a sample of children, randomly splits them into two groups and gives one group Vitamin D and the other group a placebo. Is this a prospective or retrospective study?

I believe this is a prospective study.
In this scenario, the researcher is starting with a group of children who are initially healthy and then actively intervening by giving one group Vitamin D and the other group a placebo. The researcher will follow these groups over time to observe how their health outcomes differ. This forward-looking approach i.e. starting from the intervention and moving forward to measure its effects, is characteristic of a prospective study as discussed in the lecture.

Also I would like to point out that what makes it even clearer is that the study involves randomization, which is a hallmark of experimental designs like randomized controlled trials. These types of studies are inherently prospective because they track participants into the future to assess the impact of the intervention. So in this case, Vitamin D on specific outcomes i.e. children’s health. So, I’m confident this would be classified as a prospective study.

## 3. The following data are based on a study (Petrovčič, et al, 2016) that varied the content of an email message asking persons to participate in a survey. One group received a message that included a “plea for help.” The other group received a message that did NOT include a plea for help. Here are the results:
| Message includes a plea for help | Yes | No |
|:--------------------------------|:---:|:---:|
| Yes                             | 117 | 1,131 |
| No                              | 94  | 1,158 |



## 3. a) [10 points] Estimate the relative risk of responding (plea for help vs not), and report a 95% confidence interval for log-relative risk.

Let me define the variables:
* $n_{11} = 117$ (Yes responses with plea)
* $n_{12} = 1131$ (No responses with plea)
* $n_{21} = 94$ (Yes responses without plea)
* $n_{22} = 1158$ (No responses without plea)
* $n_{1+} = n_{11} + n_{12} = 1248$ (Total with plea)
* $n_{2+} = n_{21} + n_{22} = 1252$ (Total without plea)

1) Calculating risks for each group:

Risk (plea for help) = $p_1 = \frac{n_{11}}{n_{1+}} = \frac{117}{1248} = 0.0938$ or 9.38%  
Risk (no plea) = $p_2 = \frac{n_{21}}{n_{2+}} = \frac{94}{1252} = 0.0751$ or 7.51%

2) The relative risk:
$RR = \frac{p_1}{p_2} = \frac{0.0938}{0.0751} = 1.249$

3) For the 95% CI of log(RR):
$log(RR) \pm 1.96 \times SE(log(RR))$

Where $SE(log(RR)) = \sqrt{\frac{1-p_1}{n_{1+}p_1} + \frac{1-p_2}{n_{2+}p_2}}$

$SE(log(RR)) = \sqrt{\frac{1-0.0938}{1248(0.0938)} + \frac{1-0.0751}{1252(0.0751)}} = 0.1324$

95% CI for log(RR): $ln(1.249) \pm 1.96(0.1324) = 0.223 \pm 0.259 = (-0.0365, 0.4825)$

Therefore, 95% CI for RR: $(e^{-0.0365}, e^{0.4825}) = (0.963, 1.619)$

Now, let me verify this using R:
```{r}
# Data from the table
yes_plea <- 117
no_plea <- 1131 
yes_no_plea <- 94
no_no_plea <- 1158

# Risks
risk1 <- yes_plea / (yes_plea + no_plea)
risk2 <- yes_no_plea / (yes_no_plea + no_no_plea)

# Relative risk
rr <- risk1 / risk2

# Log RR and SE
log_rr <- log(rr)
# Corrected SE formula
se_log_rr <- sqrt((1-risk1)/(risk1*(yes_plea + no_plea)) + 
                  (1-risk2)/(risk2*(yes_no_plea + no_no_plea)))

# 95% CI using dynamic z value function
z <- qnorm(0.975)
z
ci_lower <- exp(log_rr - z * se_log_rr)
ci_upper <- exp(log_rr + z * se_log_rr)

# Results
cat("Relative Risk:", round(rr, 3), "\n")
cat("95% CI:", round(ci_lower, 3), "-", round(ci_upper, 3), "\n")
```

## 3b) [10 points] Estimate the odds ratio (plea for help vs not), and report a 95% confidence interval for the log- odds ratio.

Let me define the variables again:
* $n_{11} = 117$ (Yes responses with plea)
* $n_{12} = 1131$ (No responses with plea)
* $n_{21} = 94$ (Yes responses without plea)
* $n_{22} = 1158$ (No responses without plea)

1) Calculating odds for each group:

Odds (plea for help) = $\frac{n_{11}}{n_{12}} = \frac{117}{1131} = 0.1034$
Odds (no plea) = $\frac{n_{21}}{n_{22}} = \frac{94}{1158} = 0.0812$

2) The odds ratio:
$OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{117 \times 1158}{1131 \times 94} = 1.274$

3) For 95% CI of log(OR):
$SE(log(OR)) = \sqrt{\frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}}}$

$SE(log(OR)) = \sqrt{\frac{1}{117} + \frac{1}{1131} + \frac{1}{94} + \frac{1}{1158}} = 0.1397$

95% CI for log(OR): $ln(1.274) \pm 1.96(0.1397) = 0.242 \pm 0.274 = (-0.0318, 0.5158)$

Therefore, 95% CI for OR: $(e^{-0.0318}, e^{0.5158}) = (0.959, 1.692)$

So the code for this calculation is:
```{r}
# Defining the counts
a <- 117  # responded with plea
b <- 1131 # did NOT respond with plea
c <- 94   # responded without plea
d <- 1158 # did NOT respond without plea

# Calculate odds for each group
odds_plea <- a / b
odds_no_plea <- c / d

# Calculate odds ratio
odds_ratio <- odds_plea / odds_no_plea

# Log-odds ratio and standard error
log_or <- log(odds_ratio)
se_log_or <- sqrt((1 / a) + (1 / b) + (1 / c) + (1 / d))

# 95% Confidence interval for the log-odds ratio
z <- qnorm(0.975)
z
ci_lower_log <- log_or - z * se_log_or
ci_upper_log <- log_or + z * se_log_or

# Convert back to odds ratio scale
ci_lower <- exp(ci_lower_log)
ci_upper <- exp(ci_upper_log)

# Print results
cat("Odds Ratio:", odds_ratio, "\n")
cat("95% CI for Odds Ratio: (", ci_lower, ",", ci_upper, ")\n")
```

## 3c) [5 points] Summarize and interpret your findings from parts a) and b). Does the “plea for help” improve response rates?

Based on the results from parts a) and b), I can summarize and interpret the findings as follows:

From part a), the relative risk (RR) is 1.249, with a 95% confidence interval of (0.963, 1.619). This suggests that individuals who received a message with a "plea for help" were about 24.9% more likely to respond compared to those who didn't receive such a plea. However, since the confidence interval includes 1, we can't conclude that this difference is statistically significant at the 0.05 level.

From part b), the odds ratio (OR) is 1.274, with a 95% confidence interval of (0.960, 1.692). This indicates that the odds of responding for those who received a "plea for help" were about 1.274 times the odds for those who didn't. Again, the confidence interval includes 1, suggesting that this difference is not statistically significant at the 0.05 level.

So to answer the question "Does the 'plea for help' improve response rates?", I'd say while both the relative risk and odds ratio suggest a trend towards improved response rates with the "plea for help" (both being greater than 1), one can't conclusively say that it significantly improves response rates. The confidence intervals for both measures include 1, which means one can't rule out the possibility that there's no real effect.

So in practical terms, there's a hint that the "plea for help" might be beneficial, with point estimates suggesting about a 25% increase in likelihood of response. However, given the statistical uncertainty, one should be cautious about claiming a definitive improvement. If I were advising on this study, I'd suggest that the results are promising enough to warrant further investigation with a larger sample size, which might help to narrow the confidence intervals and potentially reveal a statistically significant effect.


## 4a) [10 points] The following table is loosely based upon a study of the impact of different types of incentives on survey response rates (Deutskens, et al., 2004). Cases were randomized to either receiver a voucher that the respondent could spend at specific online vendors, or a donation would be made on their behalf. The first question is whether vouchers produce lower or higher response rates relative to donations. Calculate the odds ratio of a voucher producing response relative to donation. Calculate the deviance (G2).

| Incentive Type | Yes | No |
|:---------------|:---:|:---:|
| Voucher        | 166 | 564 |
| Donation       | 121 | 609 |


Let me define the variables for this part:
* $n_{11} = 166$ (Yes responses with voucher)
* $n_{12} = 564$ (No responses with voucher)
* $n_{21} = 121$ (Yes responses with donation)
* $n_{22} = 609$ (No responses with donation)
* $n_{1+} = n_{11} + n_{12} = 730$ (Total with voucher)
* $n_{2+} = n_{21} + n_{22} = 730$ (Total with donation)
* $n_{+1} = n_{11} + n_{21} = 287$ (Total Yes responses)
* $n_{+2} = n_{12} + n_{22} = 1173$ (Total No responses)
* $N = n_{1+} + n_{2+} = 1460$ (Total sample size)

1) Calculating odds ratio:

Odds (voucher) = $\frac{n_{11}}{n_{12}} = \frac{166}{564} = 0.294$
Odds (donation) = $\frac{n_{21}}{n_{22}} = \frac{121}{609} = 0.199$

Odds Ratio = $OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{166 \times 609}{564 \times 121} = 1.48$

2) Expected frequencies under independence:
* $E_{11} = \frac{n_{1+}n_{+1}}{N} = \frac{730 \times 287}{1460} = 143.5$
* $E_{12} = \frac{n_{1+}n_{+2}}{N} = \frac{730 \times 1173}{1460} = 586.5$
* $E_{21} = \frac{n_{2+}n_{+1}}{N} = \frac{730 \times 287}{1460} = 143.5$
* $E_{22} = \frac{n_{2+}n_{+2}}{N} = \frac{730 \times 1173}{1460} = 586.5$

3) Deviance calculation:
$G^2 = 2\sum_{i} O_i \ln(\frac{O_i}{E_i})$

$G^2 = 2[(166\ln\frac{166}{143.5}) + (564\ln\frac{564}{586.5}) + (121\ln\frac{121}{143.5}) + (609\ln\frac{609}{586.5})]$

$G^2 = 8.81$

Now, let me use R to get these values:

```{r}
# Data from the table
voucher_yes <- 166
voucher_no <- 564
donation_yes <- 121
donation_no <- 609

# Odds Ratio alculation
odds_voucher <- voucher_yes / voucher_no
odds_donation <- donation_yes / donation_no
odds_ratio <- odds_voucher / odds_donation

# Deviance (G2) calculation
observed <- c(voucher_yes, voucher_no, donation_yes, donation_no)

# Calculating expected counts
total_voucher <- voucher_yes + voucher_no
total_donation <- donation_yes + donation_no
total_yes <- voucher_yes + donation_yes
total_no <- voucher_no + donation_no
total_all <- total_voucher + total_donation

expected_voucher_yes <- (total_voucher * total_yes) / total_all
expected_voucher_no <- (total_voucher * total_no) / total_all
expected_donation_yes <- (total_donation * total_yes) / total_all
expected_donation_no <- (total_donation * total_no) / total_all

expected <- c(expected_voucher_yes, expected_voucher_no, 
              expected_donation_yes, expected_donation_no)

# Compute G2
g2 <- 2 * sum(observed * log(observed / expected))

# Print results
cat("Odds Ratio:", round(odds_ratio, 3), "\n")
cat("Deviance (G²):", round(g2, 3), "\n")
```



## 4b) [10 points] Next, we want to compare vouchers to a lottery. Calculate the odds ratio for a voucher to produce response relative to a lottery. Calculate the deviance (G2). 

| Incentive Type | Yes | No |
|:---------------|:---:|:---:|
| Voucher        | 166 | 564 |
| Lottery        | 132 | 598 |


Let me define the variables:
* $n_{11} = 166$ (Yes responses with voucher)
* $n_{12} = 564$ (No responses with voucher)
* $n_{21} = 132$ (Yes responses with lottery)
* $n_{22} = 598$ (No responses with lottery)
* $n_{1+} = n_{11} + n_{12} = 730$ (Total with voucher)
* $n_{2+} = n_{21} + n_{22} = 730$ (Total with lottery)
* $n_{+1} = n_{11} + n_{21} = 298$ (Total Yes responses)
* $n_{+2} = n_{12} + n_{22} = 1162$ (Total No responses)
* $N = n_{1+} + n_{2+} = 1460$ (Total sample size)

1) First, calculating odds ratio:

Odds (voucher) = $\frac{n_{11}}{n_{12}} = \frac{166}{564} = 0.294$
Odds (lottery) = $\frac{n_{21}}{n_{22}} = \frac{132}{598} = 0.221$

Odds Ratio = $OR = \frac{n_{11}n_{22}}{n_{12}n_{21}} = \frac{166 \times 598}{564 \times 132} = 1.33$

2) For the deviance calculation:

Expected frequencies under independence:
$E_{11} = \frac{n_{1+}n_{+1}}{N} = \frac{730 \times 298}{1460} = 149$
$E_{12} = \frac{n_{1+}n_{+2}}{N} = \frac{730 \times 1162}{1460} = 581$
$E_{21} = \frac{n_{2+}n_{+1}}{N} = \frac{730 \times 298}{1460} = 149$
$E_{22} = \frac{n_{2+}n_{+2}}{N} = \frac{730 \times 1162}{1460} = 581$

3) Calculate components of $G^2$:

$G^2 = 2[(166\ln\frac{166}{149}) + (564\ln\frac{564}{581}) + (132\ln\frac{132}{149}) + (598\ln\frac{598}{581})]$

$= 2[166(0.108) + 564(-0.0296) + 132(-0.121) + 598(0.0288)]$

$= 2[17.95 - 16.72 - 15.99 + 17.24]$

$= 2(2.48)$

$= 4.96$

```{r}
# Data from the table
voucher_yes <- 166
voucher_no <- 564
lottery_yes <- 132
lottery_no <- 598

# Odds Ratio calculation
odds_voucher <- voucher_yes / voucher_no
odds_lottery <- lottery_yes / lottery_no
odds_ratio <- odds_voucher / odds_lottery

# Deviance (G2) calculation
observed <- c(voucher_yes, voucher_no, lottery_yes, lottery_no)

# Calculating expected counts
total_voucher <- voucher_yes + voucher_no
total_lottery <- lottery_yes + lottery_no
total_yes <- voucher_yes + lottery_yes
total_no <- voucher_no + lottery_no
total_all <- total_voucher + total_lottery

expected_voucher_yes <- (total_voucher * total_yes) / total_all
expected_voucher_no <- (total_voucher * total_no) / total_all
expected_lottery_yes <- (total_lottery * total_yes) / total_all
expected_lottery_no <- (total_lottery * total_no) / total_all

expected <- c(expected_voucher_yes, expected_voucher_no, 
             expected_lottery_yes, expected_lottery_no)

# Compute G2
g2 <- 2 * sum(observed * log(observed / expected))

# Print results
cat("Odds Ratio:", round(odds_ratio, 3), "\n")
cat("Deviance (G²):", round(g2, 3), "\n")
```


## 4c) [10 points] Describe the results from the analysis of 4a and 4b. Does there appear to be differences in response rates across each of the type of incentive comparisons in 4a and 4b?


##
